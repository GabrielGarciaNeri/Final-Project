{% extends 'base.html' %}
{% load static %}
{% block title %}Register{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 400px;">
    <h2 class="text-center mb-4">Create Account</h2>

    {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {% for error in form.non_field_errors %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
    {% endif %}


    <form method="post" novalidate>
        {% csrf_token %}

        <!-- Username -->
        <div class="form-floating mb-3">
            <input type="text" name="username" id="id_username"
                class="form-control {% if form.username.errors %}is-invalid{% endif %}"
                placeholder="Username" value="{{ form.username.value|default_if_none:'' }}">
            <label for="id_username">Username</label>
            {% for error in form.username.errors %}
                <div class="invalid-feedback">
                    {{ error }}
                </div>
            {% endfor %}
        </div>

        <!-- Email -->
        <div class="form-floating mb-3">
            <input type="email" name="email" id="id_email"
                class="form-control {% if form.email.errors %}is-invalid{% endif %}"
                placeholder="Email" value="{{ form.email.value|default_if_none:'' }}">
            <label for="id_email">Email address</label>
            {% for error in form.email.errors %}
                <div class="invalid-feedback">
                    {{ error }}
                </div>
            {% endfor %}
        </div>

        <!-- Password 1 -->
        <div class="form-floating mb-3 position-relative">
            <input type="password" name="password1" id="id_password1"
                class="form-control {% if form.password1.errors %}is-invalid{% endif %}"
                placeholder="Password">
            <label for="id_password1">Password</label>
            <button type="button"
                    class="btn btn-sm btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2"
                    onclick="togglePassword('id_password1', this)">
                <i class="fa fa-eye"></i>
            </button>
            {% for error in form.password1.errors %}
                <div class="invalid-feedback d-block">
                    {{ error }}
                </div>
            {% endfor %}
        </div>

        <!-- Password 2 -->
        <div class="form-floating mb-3 position-relative">
            <input type="password" name="password2" id="id_password2"
                class="form-control {% if form.password2.errors %}is-invalid{% endif %}"
                placeholder="Confirm Password">
            <label for="id_password2">Confirm Password</label>
            <button type="button"
                    class="btn btn-sm btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2"
                    onclick="togglePassword('id_password2', this)">
                <i class="fa fa-eye"></i>
            </button>
            {% for error in form.password2.errors %}
                <div class="invalid-feedback d-block">
                    {{ error }}
                </div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-success w-100">Create Account</button>

        <p class="text-center mt-3">Already have an account?
            <a href="{% url 'login' %}">Log in here</a>
        </p>
    </form>
</div>
{% endblock %}

{% block js %}
<script>
function togglePassword(id, btn) {
    const input = document.getElementById(id);
    const icon = btn.querySelector('i');
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const inputs = document.querySelectorAll("input.form-control.is-invalid");

    inputs.forEach(function (input) {
        input.addEventListener("input", function () {
        input.classList.remove("is-invalid");

        // Hide the error message below it
            const feedback = input.parentElement.querySelector(".invalid-feedback");
            if (feedback) {
                feedback.remove();
            }
        });
    });
});
</script>
{% endblock %}